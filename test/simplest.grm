// GrimR language test file

dword cursorX, cursorY;
byte VRAM=0x80000000;
dword banana[16], tree[] = {1,2,3,4};
byte sprite[32] = {
    0xFF, 0xFF, 0xFF, 0xFA, 0xFF, 0xFF, 0xFF, 0xFB, 0xFF, 0xFF, 0xFF, 0xFC, 0xFF, 0xFF, 0xFF, 0xFD,
    0xFF, 0xFF, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0xFF, 0x01,
    0xFF, 0xFF, 0xFF, 0xFA, 0xFF, 0xFF, 0xFF, 0xFB, 0xFF, 0xFF, 0xFF, 0xFC, 0xFF, 0xFF, 0xFF, 0xFD,
    0xFF, 0xFF, 0xFF, 0xFA, 0xFF, 0xFF, 0xFF, 0xFB, 0xFF, 0xFF, 0xFF, 0xFC, 0xFF, 0xFF, 0xFF, 0xFD,
    0xFF, 0xFF, 0xFF, 0xFA, 0xF0, 0x0F, 0xFF, 0xFB, 0xFF, 0xFF, 0xFF, 0xFC, 0xFF, 0xFF, 0xFF, 0xFD,
    0xFF, 0xFF, 0xFF, 0xFA, 0xFF, 0xFF, 0xFF, 0xFB, 0xFF, 0x22, 0x2F, 0xFC, 0xFF, 0xFF, 0xFF, 0xFD,
    0xFF, 0xFF, 0xFF, 0xFA, 0xFF, 0xFF, 0xFF, 0xFB, 0xFF, 0xFF, 0xFF, 0xFC, 0xFF, 0xFF, 0xFF, 0xFD,
    0xFF, 0xFF, 0xFF, 0xFA, 0xFF, 0xFF, 0xFF, 0xFB, 0xFF, 0xFF, 0xFF, 0xFC, 0xFF, 0xED, 0xCA, 0xFD };

def test(dword thing)
{
    thing[1] = thing[0];
    return;
}

def DrawRect(word posX, word posY, word width, word height)
{
    // GrimR: Current default behavior for all variables is 'static'
    word spanX, spanY;

    spanY = posY;
    while (spanY<posY+height)
    {
        spanX = posX;
        while (spanX<posX+width)
        {
            // GrimR: Array operator can alias a variable as a pointer at that address if used on a non-array integer.
            VRAM[spanX + spanY*320] = sprite[(spanX%4) + (spanY%8)*4];
            spanX = spanX+1;
        }
        spanY = spanY+1;
    }
}

def main()
{
    DrawRect(tree[2],0,512+3-cursorY,384);

    // GrimR: Snoop a function's local variable
    if (DrawRect:spanX > 64)
    {   // GrimR: if/while always expects { }
        DrawRect(64,64,128,96);
    }
}
