# Instruction count: 137

@ORG 0x00000000

# Select frame buffer 0 for writes and clear it
ld.w r0, 0x0000
fsel r0
ld.w r0, 0x00E0
clf r0
branch main
# Select frame buffer 1 so we can see frame buffer 0
ld.w r0, 0x0001
fsel r0
halt
# End of program

@LABEL test
lea r0, test:thing
pop r1
st.d r0, r1
ld.w r0, 0x0
lea r1, test:thing
imul r0, 4
iadd r0, r1
ld.d r0, [r0]
ld.w r1, 0x1
lea r2, test:thing
imul r1, 4
iadd r1, r2
ld.d r1, [r1]
iadd r0, r1
lea r1, test:result
st.d r1, r0
ret 

@LABEL DrawRect
lea r0, DrawRect:height
pop r1
st.w r0, r1
lea r0, DrawRect:width
pop r1
st.w r0, r1
lea r0, DrawRect:posY
pop r1
st.w r0, r1
lea r0, DrawRect:posX
pop r1
st.w r0, r1
ld.w r0, [DrawRect:posY]
lea r1, DrawRect:spanY
st.w r1, r0

@LABEL beginwhile2
ld.w r0, [DrawRect:spanY]
ld.w r1, [DrawRect:posY]
ld.w r2, [DrawRect:height]
iadd r1, r2
cmp r0, r1
test less
jmpifnot endwhile3
ld.w r0, [DrawRect:posX]
lea r1, DrawRect:spanX
st.w r1, r0

@LABEL beginwhile0
ld.w r0, [DrawRect:spanX]
ld.w r1, [DrawRect:posX]
ld.w r2, [DrawRect:width]
iadd r1, r2
cmp r0, r1
test less
jmpifnot endwhile1
ld.w r0, 0x10
ld.w r1, [DrawRect:spanX]
imod r0, r1
ld.w r1, 0x10
ld.w r2, 0x8
ld.w r3, [DrawRect:spanY]
imod r2, r3
imul r1, r2
iadd r0, r1
lea r1, :sprite
iadd r0, r1
ld.b r0, [r0]
lea r1, DrawRect:spanX
ld.w r2, 0x140
lea r3, DrawRect:spanY
imul r2, r3
iadd r1, r2
lea r2, :VRAM
iadd r1, r2
st.b r1, r0
ld.w r0, [DrawRect:spanX]
ld.w r1, 0x1
iadd r0, r1
lea r1, DrawRect:spanX
st.w r1, r0
jmp beginwhile0

@LABEL endwhile1
ld.w r0, [DrawRect:spanY]
ld.w r1, 0x1
iadd r0, r1
lea r1, DrawRect:spanY
st.w r1, r0
jmp beginwhile2

@LABEL endwhile3
ret 

@LABEL main
ld.w r0, 0x2
lea r1, :tree
imul r0, 4
iadd r0, r1
ld.d r0, [r0]
push r0
ld.w r0, 0x0
push r0
ld.w r0, 0x200
ld.w r1, 0x3
iadd r0, r1
ld.d r1, [:cursorY]
isub r0, r1
push r0
ld.w r0, 0x180
push r0
branch DrawRect
ld.w r0, [DrawRect:spanX]
ld.w r1, 0x40
cmp r0, r1
test greater
jmpifnot endif4
ld.w r0, 0x1
push r0
branch test
ld.w r0, 0x2
ld.d r1, [test:result]
imul r0, r1
lea r1, main:A
st.d r1, r0

@LABEL endif4
ret 

#-------------Symbol Table-------------

@LABEL :cursorX
# ref:0 dim:1 typename:dword
@DD 0xCDCDCDCD 
@LABEL :cursorY
# ref:0 dim:1 typename:dword
@DD 0xCDCDCDCD 
@LABEL :VRAM
# ref:0 dim:1 typename:byte
@DB 0x80000000 
@LABEL :banana
# ref:0 dim:16 typename:dword
@DD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 
@DD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 
@DD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 
@DD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 0xCDCDCDCD 
@DD 
@LABEL :tree
# ref:0 dim:4 typename:dword
@DD 0x1 0x2 0x3 0x4 
@DD 
@LABEL :sprite
# ref:0 dim:256 typename:byte
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 
@DB 0xff 0xff 0xff 0xff 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0x0 0xff 
@DB 0xff 0xff 0xff 0x0 0xf6 0x9a 0x9a 0x9a 0x9a 0x9a 0x9a 0x9a 0x9a 0x9a 0x51 0x0 
@DB 0xff 0xff 0xff 0x0 0x9a 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x51 0x0 
@DB 0xff 0xff 0xff 0x0 0x9a 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x51 0x0 
@DB 0xff 0xff 0xff 0x0 0x9a 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x51 0x0 
@DB 0xff 0xff 0xff 0x0 0x9a 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x51 0x0 
@DB 0xff 0xff 0xff 0x0 0x9a 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x51 0x0 
@DB 0xff 0xff 0xff 0x0 0x9a 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x9 0x51 0x51 
@DB 
@LABEL test:result
# ref:0 dim:1 typename:dword
@DD 0xCDCDCDCD 
@LABEL test:thing
# ref:0 dim:1 typename:dword
@LABEL DrawRect:spanX
# ref:0 dim:1 typename:word
@DW 0xCDCDCDCD 
@LABEL DrawRect:spanY
# ref:0 dim:1 typename:word
@DW 0xCDCDCDCD 
@LABEL DrawRect:height
# ref:0 dim:1 typename:word
@LABEL DrawRect:width
# ref:0 dim:1 typename:word
@LABEL DrawRect:posY
# ref:0 dim:1 typename:word
@LABEL DrawRect:posX
# ref:0 dim:1 typename:word
@LABEL main:A
# ref:0 dim:1 typename:dword
@DD 0xCDCDCDCD 
@LABEL main:B
# ref:0 dim:1 typename:dword
@DD 0xCDCDCDCD 
